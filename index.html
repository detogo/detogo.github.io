<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>detogo.app</title>

    <style>
    .tab-content {
        display: flex;
        overflow-x: hidden; /* Ocultar el desplazamiento horizontal */
        width: 100%; /* Ajustar el ancho seg√∫n el n√∫mero de pantallas */
        transition: transform 0.3s ease-in-out; /* Transici√≥n suave entre pantallas */
    }

    .tab-pane {
        flex: 0 0 100%; /* Hacer que cada pantalla ocupe 100% del ancho */
        padding: 20px;
        box-sizing: border-box; /* Incluir el relleno en el ancho */
    }
</style>

<style>
.spinner {
  border: 5px solid rgba(0, 0, 0, 0.1);
  border-left: 5px solid lime; /* Amarillo */
  border-radius: 50%;
  width: 100px;
  height: 100px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

<style>
      html, body {
          margin: 0;
          padding: 0;
          height: 100%;
      }
      html {
          background: linear-gradient(45deg, black, dodgerblue);
      }
      body {
          font-family: Arial, sans-serif;
          background: linear-gradient(0deg, dodgerblue, black);
          padding: 0px; /* Ajusta el padding seg√∫n sea necesario */
      }

      .btn-llamar-telefono {
            background-color: deepskyblue;
            color: white;
            border: 2px dodgerblue;
            border-radius: 20px;
            padding: 5px 10px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.5s ease, transform 0.5s ease;
            display: inline-block;
            margin-left: 5px;
        }

        .btn-llamar-telefono:hover {
            background-color: dodgerblue;
            border-color: dodgerblue;
        }

        /* üëá efecto al presionar */
        .btn-llamar-telefono:active {
            transform: scale(1.4); /* crece un 20% */
        }

        /* ------------------------- */

        .btn-llamar-whatsapp {
            background-color: lime;
            color: black;
            border: 2px solid lime;
            border-radius: 20px;
            padding: 5px 10px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.5s ease, transform 0.5s ease;
            display: inline-block;
            margin-left: 10px;
        }

        .btn-llamar-whatsapp:hover {
            background-color: green;
            border-color: green;
        }

        /* üëá efecto al presionar */
        .btn-llamar-whatsapp:active {
            transform: scale(1.4); /* crece un 20% */
        }
 
    </style>

    <style>
.gallery_toolbar {
  padding: 1rem;
  display: flex;
  grid-template-columns: repeat(20, 25vw);
  grid-template-rows: 1fr;
  grid-column-gap: 1rem;
  grid-row-gap: 1rem;
  overflow: scroll;

 
  scroll-snap-type: both mandatory;
  scroll-padding: 1rem;

  background-color: white;
}

.active {
  scroll-snap-type: unset;
}
</style>


 <style>
    /* Estilo para el elemento select */
    select {
      width: 100%;
      padding: 10px;
      font-size: 24px !important;
      border: 4px solid dodgerblue; /* Borde de 1px s√≥lido de color DodgerBlue */
      border-radius: 15px;
      background-color: white;
      color: dodgerblue;
      cursor: pointer;
    }

    /* Estilo para las opciones del select */
    option {
      background-color: white;
      color: black;
    }
  </style>


  <style>
    /* Estilo para la imagen redonda */
    .servicio-img {
      width: 100px; /* Tama√±o de la imagen */
      height: 100px;
      border-radius: 50%; /* Hacer la imagen redonda */
      margin-right: 20px;
    }

    /* Estilo para los botones */
    .btn-tienda  {
      display: inline-block;
      padding: 10px 20px;
      margin-top: 10px;
      background-color: DodgerBlue;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

   
    }


  </style>

  <style>
        body {
            font-family: Arial, sans-serif;
            overflow-x: hidden;
        }

        /* Men√∫ lateral */
        .menu {
            pos/
            ition: fixed;
            top: 0;
            left: -250px;
            width: 250px;
            height: 100vh;
            background: black;
            color: white;
            padding: 20px;
            transition: left 0.3s ease-in-out;
            z-index: 9999; /* üî• Esto lo pone por encima de casi todo */

        }

        .menu ul {
            list-style: none;
            padding: 0;
        }

        .menu ul li {
            margin: 15px 0;
        }

        .menu ul li a {
            color: dodgerblue;
            text-decoration: none;
        }

        .menu.show {
            left: 0;
        }

        /* Bot√≥n de men√∫ (visible en PC) */
        .menu-button {
            position: relative;
            top: 20px;
            left: 20px;
            background: black;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            z-index: 100;
            border-radius: 5px;
        }

        /* Ocultar la primera columna en m√≥viles y usarla como men√∫ */
        @media (max-width: 768px) {
            .col-sm-3:first-child {
                display: none;
            }

            .menu-button {
                display: none;
            }
        }
    </style>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<!-- Agrega el siguiente script para cargar la biblioteca desde un CDN -->
<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>


</head>


<body>
<script src="miTienda.js"></script>
<script src="stakingpool.js"></script>
<script src="responses.js"></script>

<br>
 





<div class="row">
 

   <div class="col-sm-1"> 
   </div>


          
 <div class="col-sm-6">   


<!--   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<!--   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<!--   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
 <div id="menu" class="menu">
               
                <ul>    
                    <li>                         
                           <center>
                             <img id="image-perfil" src="detogo_app/detogo_logo.svg" alt="My svg_logo"  width="100"       class="img-circle">
                           </center>
                        
                    </li>   

                    <li> 
                            <center><h3><p> Detogo.app<p></p></center>
                            <center><h5><p> Aqui encontraras de todo, cerca de ti y sin intermediarios </p></h5> </center> 
                      
                    </li>  



                     
                              <select id="select-departamento">
                                 <option value="Ahuachapan" >Seleccione departamento</option>
                              </select>
                                              

                         
                              <select id="select-municipio">
                                 <option value="Ahuachapan" >Seleccione Municipio</option>
                              </select>
                         
                               
                                
                               <select id="select-servicio">
                                  <option value="Ahuachapan" >Seleccione Servicio</option>
                               </select>

                        


                    

                                                    
                    
                       <li><a href="https://api.detogo.app">api.detogo </a>
                       
                       </li>
                      
                      <!-- Copiar clave -->
                     
                      <li>
                          
                          <button class="btn-llamar-whatsapp"  onclick="cambiar_apidetogo(0)" style="display: inline-block; margin-left: 15px; margin-top: 5px;">api.detogo</button>
                      </li>

                      

                     

                     

                 </ul>
     </div>
<!--   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<!--   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<!--   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->




 <div class="well" style="border: none; border-radius: 20px; background:black; padding: 0px;">
              
                <div style="display: flex; align-items: center;  padding: 5px;">


                   
                    <input type="text" id="imput_buscar" placeholder="Que buscas hoy?"
                       style="border: 2px solid black; border-radius: 20px; height: 40px; flex: 1;">
                    
                 
                   <a data-toggle="tab" href="" style="margin-left: 10px;">
                       <img id="image-home" src="detogo_app/buscar_icon.SVG" alt="home" width="35">
                   </a>  


                   <a href="javascript:void(0)" 
                         style="margin-left: 10px; margin-right: 10px; display: flex; align-items: center;"
                         onclick="pedirUbicacion()">
                         <img id="image-food" src="detogo_app/gps.SVG" alt="ubicacion" width="35">
                   </a>

                   <a id="menuBtn"  style=" margin-left: 10px;margin-right: 10px; display: flex; align-items: center;">  <img  id="image-food" src="detogo_app/menu.SVG" alt="ubicacion" width="35"> </a>          

                       
                                
               </div>
             

 </div>  

     
<div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 5px; margin-bottom: : 5px">

  <center><div id="loadingAnimation-principal" style="display: none;">
                                       
                    <div class="spinner"></div> 
                                                 
  </div>  </center> 

 

  <!-- Texto -->
  <!--<h4 style="margin: 0; color: dodgerblue; font-style: italic;">detogo.app</h4>  -->

  <!-- Botones -->
  <div id="botones-administracion">
    
  </div>


</div>



<div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 5px; margin-bottom: : 5px">
<h5 id="municipio" style="color: white;"></h5>
<h4 id="servicio" style="color: white;"></h4>


</div>


       <!--  <div class="well" style="background: linear-gradient(45deg, black, yellow);">  -->
 <div class="well" style="border: 2px solid skyblue; border-radius: 20px; margin-top: 10px;">
     
                    <!--<div style="background: red; width:90px; height: 50px; display: inline-block; margin-top: 50px;"></div>  -->


<style>
          

          .calle {
            position: relative;
            width: 100%;
            height: 250px; /* Ajusta la altura de la calle seg√∫n tus necesidades */
            background-color: #888; /* Color de la calle */
            overflow: hidden;
          }

          .linea {
            position: absolute;
            width: 50%;
            height: 2px; /* Grosor de la l√≠nea */
            background-color: #fff; /* Color de la l√≠nea */
            animation: mover-linea 2s linear infinite; /* Ajusta la duraci√≥n de la animaci√≥n seg√∫n tus necesidades */
          }

          .linea:nth-child(1) {
            top: 30px; /* Ajusta la posici√≥n vertical de la primera l√≠nea */
            right: : 30px;
            height: 10px;
          }

          .moto {
            position: absolute;
            top: 10px; /* Ajusta la posici√≥n vertical de la moto */
            left: -50px; /* Ajusta la posici√≥n inicial horizontal de la moto */
            animation: mover-moto 6s linear infinite, vibrar-moto 0.1s alternate infinite; /* Ajusta la velocidad de movimiento y vibraci√≥n seg√∫n tus necesidades */
          }

          @keyframes mover-linea {
            0% { right: -50%; }
            100% { right: 100%; }
          }

          @keyframes mover-moto {
            50% { left: -50px; }
            60% { left: 100%; }
          }

          @keyframes vibrar-moto {
            0% { transform: translateY(0); }
            25% { transform: translateY(-2px); }
            50% { transform: translateY(0); }
            75% { transform: translateY(2px); }
            100% { transform: translateY(0); }
          }

</style>








<ul class="gallery_toolbar">     
     
       <a data-toggle="tab" href="#home" style=" margin-left: 15px;">  <img  id="image-home" src="detogo_app/home.SVG" alt="home" width="45"></a> 
       <a data-toggle="tab" href="#godelivery" style=" margin-left: 15px;">  <img  id="image-home" src="detogo_app/godelivery.SVG" alt="home" width="45"> </a>
       <a data-toggle="tab" href="#gocars" style=" margin-left: 15px;">  <img  id="image-cars" src="detogo_app/gocar.SVG" alt="home" width="45"> </a>
       <a data-toggle="tab" href="#gofood" style=" margin-left: 15px;">  <img  id="image-food" src="detogo_app/gofood.SVG" alt="home" width="45"> </a>
       <a data-toggle="tab" href="#gomarkets" style=" margin-left: 15px;">  <img  id="image-market" src="detogo_app/gomarket.SVG" alt="home" width="45"> </a>
                                   
       <a data-toggle="tab" href="#mymarket" style=" margin-left: 15px;">  <img  id="image-mymarket" src="detogo_app/mymarket.SVG" alt="mymarket" width="45"> </a>

       <a data-toggle="tab" href="#goservice" style=" margin-left: 15px;">  <img  id="image-service" src="detogo_app/goservice.SVG" alt="home" width="45"> </a>
       
       
</ul>


  <div class="tab-content">

        <div id="home" class="tab-pane fade in active" >
                        
        </div>
       <!--#################################################-->    





    <div id="godelivery" class="tab-pane fade">   
        

            <center>

              <center><h2 style="display: inline-block; margin: 0; vertical-align: middle; margin-left: 2px;"><font color="skyblue"> <i>-- Deliverys --</i> </font> </h2> </center>



              <div class="calle">
                    <div class="linea"></div>
                    <img src="detogo_app/moto.SVG" alt="Moto" width="250" class="moto">
              </div>
       
               <br>

                <div id= "selector-deliverys">
                </div>
                
                <br>

                <div id= "botones-deliverys">
                </div>
            
            </center>

               
    </div>  






    <div id="gocars" class="tab-pane fade">             


              
           <center>   
                 
              <center><h2 style="display: inline-block; margin: 0; vertical-align: middle; margin-left: 2px;"><font color="skyblue"> <i>-- Viajes --</i> </font> </h2> </center>

              <div class="calle">
                    <div class="linea"></div>                    
                     <img id="imagen-vehiculo" src="detogo_app/carro.SVG" alt="Carro" width="350" class="moto">

              </div>            

               <br>

                
                <div id="selector-tipo-car">
                </div>
                
                <br>

                <div id= "selector-cars">                	
                </div>
                               

                <div id="Descripcion">                	
                </div> 

                <br>

                <div id= "botones-cars">                	
                </div>
            
            </center>







        
    </div>
    


    <!--/////////////////////////////////////////////////////////////-->
    <!--/////////////////////////////////////////////////////////////-->
    <div id="gofood" class="tab-pane fade"> 
         <center><h2 style="display: inline-block; margin: 0; vertical-align: middle; margin-left: 2px;"><font color="skyblue"> <i>-- Comidas --</i> </font> </h2> </center>

        <div id="solo-comidas">
        </div>    
    
    </div>
    <!--/////////////////////////////////////////////////////////////-->
    <!--/////////////////////////////////////////////////////////////-->


     <!--/////////////////////////////////////////////////////////////-->
    <!--/////////////////////////////////////////////////////////////-->
    <div id="gomarkets" class="tab-pane fade">   
        <center><h2 style="display: inline-block; margin: 0; vertical-align: middle; margin-left: 2px;"><font color="skyblue"> <i>-- Tiendas --</i> </font> </h2> </center>
        
        <div id="markets">
        </div> 
    
    </div>
    <!--/////////////////////////////////////////////////////////////-->
    <!--/////////////////////////////////////////////////////////////-->

     

      <!--/////////////////////////////////////////////////////////////-->
    <!--/////////////////////////////////////////////////////////////-->
    <div id="mymarket" class="tab-pane fade">  
        <center><h2 style="display: inline-block; margin: 0; vertical-align: middle; margin-left: 2px;"><font color="skyblue"> <i>-- Menu tienda --</i> </font> </h2> </center>  
        
        <div id="my-market">
        </div> 
    
    </div>
    <!--/////////////////////////////////////////////////////////////-->
    <!--/////////////////////////////////////////////////////////////-->





     <!--/////////////////////////////////////////////////////////////-->
    <!--/////////////////////////////////////////////////////////////-->
    <div id="goservice" class="tab-pane fade">  
         
          <style>
              .lista-nombres {
                               display: none;  /* No aparece la lista de nombres al principio  */
                             } 
          </style>   
         
          <center><h2 style="display: inline-block; margin: 0; vertical-align: middle; margin-left: 2px;"><font color="skyblue"> <i>-- Servicios --</i> </font> </h2> </center>

          <div id="service" >
          </div> 


    
    </div>
    <!--/////////////////////////////////////////////////////////////-->
    <!--/////////////////////////////////////////////////////////////-->

      

  </div>                 
  
     
                </div>
            </div>



            <div class="col-sm-4">
                 <div class="well" style="border: 2px solid skyblue; border-radius: 20px;">

                    <h4>Te puede interesar:</h4>
                    <div id="lista-promocionales"></div> 
                                         
                                                                 
           
                    
                </div>                
                      



            </div>

            <div class="col-sm-1"> 
            </div>

            
        </div>
   
<!-- #########################################################################################
##############################################################################################
##############################################################################################-->




<script>
    
const isAppInventor = (typeof AppInventor !== "undefined" && typeof AppInventor.setWebViewString === "function");
// Obtener el elemento select para el departamento

const selectDepartamento = document.getElementById("select-departamento");
const selectMunicipio = document.getElementById("select-municipio");
const selectServicio = document.getElementById("select-servicio");

let estructura = []; // Aqu√≠ guardaremos toda la estructura depto/municipio/servicio
const username = "detogo";
const repo = "detogo.github.io";



document.addEventListener("DOMContentLoaded", async () => {


    const loadingAnimation = document.getElementById('loadingAnimation-principal');
    loadingAnimation.style.display = 'block'; // Muestra la animaci√≥n al ejecutar la funci√≥n

    await listarEstructura();

    try {
        const coords = await obtenerUbicacionGPS(); // GPS
        console.log("Coordenadas del GPS:", coords);

        // Guardar como respaldo
        localStorage.setItem("miLatitudGPS", coords.lat);
        localStorage.setItem("miLongitudGPS", coords.lng);

        const masCercano = encontrarMasCercano(coords);
        setearSelects(masCercano);
        console.log("M√°s cercano:", masCercano);





    } catch (err) {
        console.error(err);
        console.log("No se obtuvieron coordenadas del GPS.");

        const coords = obtenerCoordenadasGuardadas();
        if (coords) {
            const masCercano = encontrarMasCercano(coords);
            setearSelects(masCercano);
            console.log("M√°s cercano:", masCercano);
        } else {
            console.log("No hay coordenadas guardadas.");
        }

    }

    loadingAnimation.style.display = 'none'; // quita la animacion
});





// ----------------- FUNCION PARA LISTAR CARPETAS -----------------
async function listarEstructura() {
    try {
        const response = await fetch(`https://api.github.com/repos/${username}/${repo}/contents`);
        const departamentos = await response.json();

        for (const dep of departamentos) {
            if (dep.type === "dir" && dep.name !== ".git" && dep.name !== "detogo_app") {
                let objDep = { nombre: dep.name, municipios: [] };

                // Municipios
                const respMun = await fetch(dep.url);
                const municipios = await respMun.json();

                for (const mun of municipios) {
                    if (mun.type === "dir") {
                        let objMun = { nombre: mun.name, servicios: [] };

                        // Servicios
                        const respServ = await fetch(mun.url);
                        const servicios = await respServ.json();

                        for (const serv of servicios) {
                            if (serv.type === "dir") {
                                let objServ = { nombre: serv.name, data: null };

                                // Buscar administracion.py
                                const respAdmin = await fetch(serv.url);
                                const archivos = await respAdmin.json();

                                const adminFile = archivos.find(f => f.name === "administracion.txt");
                                if (adminFile) {
                                    const adminResp = await fetch(adminFile.download_url);
                                    const contenido = await adminResp.text();

                                    try {
                                        objServ.data = JSON.parse(contenido);
                                    } catch {
                                        console.warn("Error parseando JSON en", adminFile.path);
                                    }
                                }

                                objMun.servicios.push(objServ);
                            }
                        }

                        objDep.municipios.push(objMun);
                    }
                }

                estructura.push(objDep);
            }
        }

        // Llenar select de departamentos
        estructura.forEach(dep => {
            const option = document.createElement("option");
            option.value = dep.nombre;
            option.textContent = dep.nombre;
            selectDepartamento.appendChild(option);
        });

        console.log("Estructura cargada:", estructura);

    } catch (err) {
        console.error("Error listando estructura:", err);
    }
}

// ----------------- ACTUALIZAR MUNICIPIOS -----------------
function actualizarMunicipios() {
    selectMunicipio.innerHTML = "<option>Seleccione Municipio</option>";
    selectServicio.innerHTML = "<option>Seleccione Servicio</option>";

    const dep = estructura.find(d => d.nombre === selectDepartamento.value);
    if (dep) {
        dep.municipios.forEach(mun => {
            const option = document.createElement("option");
            option.value = mun.nombre;
            option.textContent = mun.nombre;
            selectMunicipio.appendChild(option);
        });
    }
}

// ----------------- ACTUALIZAR SERVICIOS -----------------
function actualizarServicios() {
    selectServicio.innerHTML = "<option>Seleccione Servicio</option>";

    const dep = estructura.find(d => d.nombre === selectDepartamento.value);
    if (!dep) return;

    const mun = dep.municipios.find(m => m.nombre === selectMunicipio.value);
    if (mun) {
        mun.servicios.forEach(serv => {
            const option = document.createElement("option");
            option.value = serv.nombre;
            option.textContent = serv.nombre;
            selectServicio.appendChild(option);
        });
    }
}


function obtenerUbicacionGPS() {
    return new Promise((resolve, reject) => {
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    resolve({
                        lat: pos.coords.latitude,
                        lng: pos.coords.longitude
                    });
                },
                (err) => {
                    reject("No se pudo obtener ubicaci√≥n: " + err.message);
                }
            );
        } else {
            reject("Tu navegador no soporta geolocalizaci√≥n.");
        }
    });
}




// Funci√≥n para recuperar coordenadas guardadas
function obtenerCoordenadasGuardadas() {
        const lat = localStorage.getItem("miLatitud");
        const lng = localStorage.getItem("miLongitud");

        if (lat && lng) {
            alert("Latitud inicial: " + lat + " - Longitud inicial: " + lng);
            return { lat: parseFloat(lat), lng: parseFloat(lng) };
           
        } else {
            return null;
        }
}




// ----------------- FUNCION DISTANCIA -----------------
function calcularDistancia(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
        Math.sin(dLat/2) ** 2 +
        Math.cos(lat1 * Math.PI/180) * Math.cos(lat2 * Math.PI/180) *
        Math.sin(dLon/2) ** 2;
    return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
}

// ----------------- ENCONTRAR MAS CERCANO -----------------
function encontrarMasCercano(coords) {
    let mejor = null;
    let menorDistancia = Infinity;

    console.log("Estructura :",estructura );

    estructura.forEach(dep => {
        dep.municipios.forEach(mun => {
            mun.servicios.forEach(serv => {
                if (serv.data && serv.data.Administracion) {
                    serv.data.Administracion.forEach(admin => {
                        

                        const [lat, lon] = admin.coorxy.split(",").map(Number);
                        console.log("lat long encontrada:",coords.lat, coords.lng, lat, lon );
                        const dist = calcularDistancia(coords.lat, coords.lng, lat, lon);

                        if (dist < menorDistancia) {
                            menorDistancia = dist;
                            mejor = {
                                departamento: dep.nombre,
                                municipio: mun.nombre,
                                servicio: serv.nombre,
                                data: admin,
                                distancia: dist
                            };
                        }
                    });
                }
            });
        });
    });

    return mejor;
}


function setearSelects(masCercano) {
    if (!masCercano) return;

    // Departamento
    selectDepartamento.value = masCercano.departamento;

    // Municipios de ese departamento
    const dep = estructura.find(d => d.nombre === masCercano.departamento);
    if (dep) {
        selectMunicipio.innerHTML = "";
        dep.municipios.forEach(mun => {
            const option = document.createElement("option");
            option.value = mun.nombre;
            option.textContent = mun.nombre;
            selectMunicipio.appendChild(option);
        });
        selectMunicipio.value = masCercano.municipio;

        // Servicios de ese municipio
        const mun = dep.municipios.find(m => m.nombre === masCercano.municipio);
        if (mun) {
            selectServicio.innerHTML = "";
            mun.servicios.forEach(serv => {
                const option = document.createElement("option");
                option.value = serv.nombre;
                option.textContent = serv.nombre;
                selectServicio.appendChild(option);
            });
            selectServicio.value = masCercano.servicio;

             // üîπ Disparar el evento 'change' para que se ejecute actualizar_plataforma
             const event = new Event("change");
             selectServicio.dispatchEvent(event);
        }
    }
}































    



   








// Encuentra la ubicaci√≥n m√°s cercana
async function encontrarUbicacionMasCercana(coords) {
    let mejor = null;
    let menorDistancia = Infinity;

    for (const carpeta of carpetas) {   // üîπ ahora iteras sobre carpetas
        try {
            const username = 'detogo';
            const repo = 'detogo.github.io';
            const rutaArchivo = `${carpeta}/json_perfiles.txt`;

            // Llamada a la API de GitHub para obtener contenido del archivo
            const resp = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${rutaArchivo}`);
            if (!resp.ok) continue;

            const dataGitHub = await resp.json();
            // El contenido viene en base64 ‚Üí decodificar
            const contenido = atob(dataGitHub.content);
            const data = JSON.parse(contenido);

            // Tomamos la primera administraci√≥n
            if (data.Administracion && data.Administracion.length > 0) {
                const coorxy = data.Administracion[0].coorxy;
                const partes = coorxy.split(",");
                const lat = parseFloat(partes[0]);
                const lng = parseFloat(partes[1]);

                const distancia = calcularDistancia(
                    coords.lat, coords.lng,
                    lat, lng
                );

                if (distancia < menorDistancia) {
                    menorDistancia = distancia;
                    mejor = { carpeta, data, distancia };
                }
            }
        } catch (e) {
            console.error("Error leyendo carpeta", carpeta, e);
        }
    }

    return mejor;
}





// Funci√≥n principal que busca la ubicaci√≥n m√°s cercana y actualiza todo
async function actualizarSegunUbicacion(coords) {
    if (!coords) {
        console.log("No hay coordenadas para buscar.");
        return;
    }

    console.log("Buscando ubicaci√≥n m√°s cercana a:", coords);

    const masCercano = await encontrarUbicacionMasCercana(coords);

    if (masCercano) {
        console.log("Ubicaci√≥n m√°s cercana:", masCercano);

        // Sacamos depto y municipio desde el nombre de la carpeta
        const partes = masCercano.carpeta.split(",");
        const departamento = partes[0];
        const ubicacion = partes.slice(1).join(",");

        // Seteamos los selects
        selectDepartamento.value = departamento;
        await actualizarUbicaciones(); 
        selectUbicacion.value = ubicacion;

        // Ejecutar tu funci√≥n principal
        actualizar_plataforma();
    } else {
        console.log("No se encontr√≥ ubicaci√≥n cercana.");
    }
}

// Funci√≥n que llama cuando se obtiene nueva ubicaci√≥n del GPS
function recibirCoordenadas(lat, lng) {
    console.log("Ubicaci√≥n recibida:", lat, lng);
    alert("Latitud solicitada: " + lat + " - Longitud solicitada: " + lng);

    // Guardar coordenadas en localStorage
    localStorage.setItem("miLatitud", lat);
    localStorage.setItem("miLongitud", lng);

    // Llamar a la funci√≥n √∫nica para actualizar todo
    actualizarSegunUbicacion({ lat: parseFloat(lat), lng: parseFloat(lng) });
}


</script>


<script>
 

async function actualizarUbicaciones() {
    // Obtener el departamento seleccionado
    const departamentoSeleccionado = selectDepartamento.value;
    console.log('Departamento seleccionado:', departamentoSeleccionado);

    // Limpiar las opciones actuales del select de ubicaci√≥n
    selectUbicacion.innerHTML = "";

    // Filtrar las carpetas seg√∫n el departamento seleccionado
    const carpetasFiltradas = carpetas.filter(nombreCarpeta => {
        // Ignorar carpetas especiales
        if (nombreCarpeta === ".git" || nombreCarpeta === "detogo_app") return false;
        const partes = nombreCarpeta.split(",");
        return partes[0] === departamentoSeleccionado;
    });

    console.log('Carpetas filtradas:', carpetasFiltradas);

    // Crear nuevas opciones basadas en los nombres filtrados
    carpetasFiltradas.forEach(nombreCarpeta => {
        const partes = nombreCarpeta.split(",");
        const municipioNombre = partes.slice(1).join(","); // todo lo que queda despu√©s del departamento
        console.log('Municipio:', municipioNombre);

        const option = document.createElement("option");
        option.value = municipioNombre;
        option.textContent = municipioNombre;
        selectUbicacion.appendChild(option);
    });
}







 async function actualizar_plataforma() {
    const departamentoSeleccionado = selectDepartamento.value;
    const municipioSeleccionado = selectMunicipio.value;
    const servicioSeleccionado = selectServicio.value;

    document.getElementById("municipio").textContent = municipioSeleccionado;
    document.getElementById("servicio").textContent = servicioSeleccionado;

    // Buscar el objeto del servicio en estructura
    const dep = estructura.find(d => d.nombre === departamentoSeleccionado);
    if (!dep) return;
    const mun = dep.municipios.find(m => m.nombre === municipioSeleccionado);
    if (!mun) return;
    const serv = mun.servicios.find(s => s.nombre === servicioSeleccionado);
    if (!serv || !serv.data) {
        console.error("No se encontr√≥ administracion.txt para este servicio");
        return;
    }

    const contenidoJSON = serv.data;
    console.log("Contenido del archivo JSON:", contenidoJSON);

    // Actualizar secciones
    const datos_administracion = contenidoJSON.Administracion;
    actualizar_pantalla_administracion(datos_administracion);

    await actualizar_tiendas(); // Si actualizar_tiendas es async y quieres esperar a que termine

    const datos_deliverys = contenidoJSON.Deliverys;               
    actualizar_pantalla_deliverys(datos_deliverys);

    const datos_cars = contenidoJSON.Cars;               
    actualizar_pantalla_cars(datos_cars);

    const datos_markets = contenidoJSON.Markets;               
    actualizar_pantalla_markets(datos_markets);

    const datos_comida = contenidoJSON.Markets?.Comida;  
    actualizar_pantalla_comidas(datos_comida);

    const datos_servicio = contenidoJSON.Services;  
    actualizar_pantalla_servicios(datos_servicio);

    listar_promocionales();
}

// ----------------- CUANDO CAMBIO SELECT -----------------
selectDepartamento.addEventListener("change", actualizarMunicipios);
selectMunicipio.addEventListener("change", actualizarServicios);
selectServicio.addEventListener("change", actualizar_plataforma);

// ----------------- INICIO -----------------



// Agregar un evento change al select de departamento para actualizar las ubicaciones
//selectDepartamento.addEventListener("change", actualizarUbicaciones);
//selectDepartamento.addEventListener("change", actualizar_plataforma);
//selectUbicacion.addEventListener("change", actualizar_plataforma);


</script>


<!-- #########################################################################################
##############################################################################################
##############################################################################################-->


<script>

/////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////		
 function actualizar_pantalla_administracion(datos_administracion) {
    console.log('Actualizar administracion.', datos_administracion);

    const divBotonesAdministracion = document.getElementById('botones-administracion');

    // Limpiar el contenido actual del div
    divBotonesAdministracion.innerHTML = '';


    // Crear la imagen din√°micamente
    const imgAdministrador = document.createElement("img");

    // Asignar atributos
    imgAdministrador.id = "image-administrador";
    imgAdministrador.src = "detogo_app/detogo_logo.svg";
    imgAdministrador.alt = "My svg_logo";
    imgAdministrador.width = 60;
    imgAdministrador.classList.add("img-circle");

    divBotonesAdministracion.appendChild(imgAdministrador);

    // Iterar sobre los datos de administraci√≥n
    datos_administracion.forEach(item => {
        const nombre = item.nombre;
        const telefono = item.tel;
        const coordenadas = item.coorxy;

        // Crear el bot√≥n de llamada telef√≥nica
        const btnLlamar = document.createElement('button');
        btnLlamar.textContent = 'Llamar';
        btnLlamar.classList.add('btn-llamar-telefono');
        btnLlamar.onclick = function() {
            llamar_telefono(telefono);
        };

        // Crear el bot√≥n de WhatsApp
        const btnWhatsapp = document.createElement('button');
        btnWhatsapp.textContent = 'WhatsApp';
        btnWhatsapp.classList.add('btn-llamar-whatsapp');
        btnWhatsapp.onclick = function() {
            enviar_whatsapp(telefono);
        };

        // Agregar los botones al div
        divBotonesAdministracion.appendChild(btnLlamar);
        divBotonesAdministracion.appendChild(btnWhatsapp);
    });
}



///////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
async function actualizar_tiendas() {
    const departamento = selectDepartamento.value;
    const municipio = selectMunicipio.value;
    const servicio = selectServicio.value;

    const homeDiv = document.getElementById("home");
    homeDiv.innerHTML = "";

    const carpetaTiendas = "tiendas";

    try {
        // üìÇ Obtener lista de archivos y subcarpetas dentro de /tiendas
        const responseTiendas = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${departamento}/${municipio}/${servicio}/${carpetaTiendas}`);
        if (!responseTiendas.ok) throw new Error("No se pudo acceder a la carpeta tiendas");
        const archivosTiendas = await responseTiendas.json();

        // üîπ Primero mostrar im√°genes sueltas directamente dentro de /tiendas
        for (const file of archivosTiendas) {
            if (file.type === "file" && /\.(jpg|jpeg|png|svg)$/i.test(file.name)) {
                await crearFila(file, homeDiv);
            }
        }

        // üîπ Luego, procesar todas las subcarpetas (como comida, ropa, bebidas, etc.)
        for (const folder of archivosTiendas) {
            if (folder.type === "dir") {
                const subFolderName = folder.name;

                // Crear encabezado colapsable
                const folderDiv = document.createElement("div");
                folderDiv.style.marginBottom = "20px";
                folderDiv.style.border = "1px solid #555";
                folderDiv.style.borderRadius = "10px";
                folderDiv.style.padding = "10px";
                folderDiv.style.background = "lightgray";

                // T√≠tulo clickeable
                const title = document.createElement("h2");
                title.textContent = subFolderName;
                title.style.color = "white";
                title.style.cursor = "pointer";
                title.style.userSelect = "none";
                title.style.marginBottom = "10px";
                title.style.textTransform = "capitalize";

                // Contenedor para las im√°genes de esa subcarpeta
                const contenidoDiv = document.createElement("div");
                contenidoDiv.style.display = "none"; // oculto por defecto
                contenidoDiv.style.marginLeft = "10px";
                contenidoDiv.style.marginTop = "10px";

                // Evento para desplegar/ocultar
                title.addEventListener("click", () => {
                    const visible = contenidoDiv.style.display === "block";
                    contenidoDiv.style.display = visible ? "none" : "block";
                });

                // Agregar t√≠tulo y contenido al bloque principal
                folderDiv.appendChild(title);
                folderDiv.appendChild(contenidoDiv);
                homeDiv.appendChild(folderDiv);

                // Obtener archivos de la subcarpeta
                const respSub = await fetch(folder.url);
                if (respSub.ok) {
                    const archivosSub = await respSub.json();
                    for (const file of archivosSub) {
                        if (file.type === "file" && /\.(jpg|jpeg|png|svg)$/i.test(file.name)) {
                            await crearFila(file, contenidoDiv);
                        }
                    }
                }
            }
        }

    } catch (error) {
        console.error("Error al listar carpeta tiendas:", error);
    }
}

// üß± Funci√≥n auxiliar para construir la fila
async function crearFila(file, container) {
    const nombreImagen = file.name.split(".")[0];
    const imageUrl = file.download_url;

    const fila = document.createElement("div");
    fila.style.display = "flex";
    fila.style.alignItems = "center";
    fila.style.marginBottom = "15px";
    fila.style.gap = "15px";

    const img = document.createElement("img");
    img.src = imageUrl;
    img.alt = nombreImagen;
    img.style.width = "100px";
    img.style.objectFit = "cover";
    img.style.borderRadius = "10px";

    const infoDiv = document.createElement("div");
    infoDiv.style.display = "flex";
    infoDiv.style.flexDirection = "column";
    infoDiv.style.justifyContent = "center";

    const nombre = document.createElement("h3");
    nombre.textContent = nombreImagen;
    nombre.style.margin = "0 0 10px 0";
    nombre.style.color = "dodgerblue";

    const btnLlamar = document.createElement("button");
    btnLlamar.textContent = "Llamar";
    btnLlamar.classList.add('btn-llamar-telefono');
   

    const btnWhatsapp = document.createElement("button");
    btnWhatsapp.textContent = "Whatsapp";
    btnWhatsapp.classList.add('btn-llamar-whatsapp');
 

    const botonesDiv = document.createElement("div");
    botonesDiv.style.display = "flex";
    botonesDiv.appendChild(btnLlamar);
    botonesDiv.appendChild(btnWhatsapp);

    infoDiv.appendChild(nombre);
    infoDiv.appendChild(botonesDiv);

    fila.appendChild(img);
    fila.appendChild(infoDiv);

    container.appendChild(fila);
}




















/////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

function actualizar_pantalla_deliverys(datos_deliverys) {
    const divSelectorDeliverys = document.getElementById('selector-deliverys');
    const divBotonesDeliverys = document.getElementById('botones-deliverys');

    // Limpiar el contenido actual de los elementos
    divSelectorDeliverys.innerHTML = '';
    divBotonesDeliverys.innerHTML = '';

    // Crear el select de deliverys
    const selectDeliverys = document.createElement('select');
    selectDeliverys.setAttribute('id', 'select-deliverys');

    // Agregar una opci√≥n predeterminada
    const defaultOption = document.createElement('option');
    defaultOption.textContent = 'Selecciona un delivery';
    selectDeliverys.appendChild(defaultOption);


    //console.log('datos_deliverys.', datos_deliverys);
    // Iterar sobre los datos de deliverys y agregar opciones al select
    for (const tipo in datos_deliverys) {
        if (datos_deliverys.hasOwnProperty(tipo)) {
            datos_deliverys[tipo].forEach(persona => {
                const option = document.createElement('option');
                option.textContent = persona.nombre;
                option.setAttribute('data-tel', persona.tel); // Guardar el n√∫mero de tel√©fono como atributo de datos
                selectDeliverys.appendChild(option);
            });
        }
    }

    // Agregar el select al div correspondiente
    divSelectorDeliverys.appendChild(selectDeliverys);

    // Agregar el evento onChange al select
    selectDeliverys.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const numeroTelefono = selectedOption.getAttribute('data-tel');

        // Crear botones para llamar por tel√©fono y WhatsApp
        const btnLlamar = document.createElement('button');
        btnLlamar.textContent = 'Llamar';
        btnLlamar.classList.add('btn-llamar-telefono');
        btnLlamar.onclick = function() {
            llamar_telefono(numeroTelefono);
        };

        const btnWhatsapp = document.createElement('button');
        btnWhatsapp.textContent = 'WhatsApp';
        btnWhatsapp.classList.add('btn-llamar-whatsapp');
        btnWhatsapp.onclick = function() {
            enviar_whatsapp(numeroTelefono);
        };

        // Limpiar el contenido actual de los botones y agregar los nuevos
        divBotonesDeliverys.innerHTML = '';
        divBotonesDeliverys.appendChild(btnLlamar);
        divBotonesDeliverys.appendChild(btnWhatsapp);
    });
}


function actualizar_pantalla_cars(datos_cars) {
    const divSelectorTipoCar = document.getElementById('selector-tipo-car');
    const divSelectorCars = document.getElementById('selector-cars');
    const divDescripcion = document.getElementById('Descripcion');
    const divBotonesCars = document.getElementById('botones-cars');
    const imagenVehiculo = document.getElementById('imagen-vehiculo');

    // Limpiar el contenido actual de los elementos
    divSelectorTipoCar.innerHTML = '';
    divSelectorCars.innerHTML = '';
    divDescripcion.innerHTML = '';
    divBotonesCars.innerHTML = '';

    // Crear el select para el tipo de veh√≠culo
    const selectTipoCar = document.createElement('select');
    selectTipoCar.setAttribute('id', 'select-tipo-car');

    // Agregar una opci√≥n predeterminada
    const defaultOptionTipoCar = document.createElement('option');
    defaultOptionTipoCar.textContent = 'Selecciona un tipo de veh√≠culo';
    selectTipoCar.appendChild(defaultOptionTipoCar);

    // Iterar sobre los tipos de veh√≠culos y agregar opciones al select
    for (const tipo in datos_cars) {
        if (datos_cars.hasOwnProperty(tipo)) {
            const optionTipoCar = document.createElement('option');
            optionTipoCar.textContent = tipo;
            selectTipoCar.appendChild(optionTipoCar);
        }
    }

    // Agregar el select de tipo de veh√≠culo al div correspondiente
    divSelectorTipoCar.appendChild(selectTipoCar);

    // Crear el select de cars
    const selectCars = document.createElement('select');
    selectCars.setAttribute('id', 'select-cars');

    // Agregar una opci√≥n predeterminada
    const defaultOption = document.createElement('option');
    defaultOption.textContent = 'Selecciona un veh√≠culo';
    selectCars.appendChild(defaultOption);

    // Agregar el select de cars al div correspondiente
    divSelectorCars.appendChild(selectCars);

    // Agregar evento onChange al select de tipo de veh√≠culo
    selectTipoCar.addEventListener('change', function() {
        const selectedTipo = this.options[this.selectedIndex].textContent;

        // Limpiar el contenido actual del select de cars
        selectCars.innerHTML = '';

        // Iterar sobre los veh√≠culos del tipo seleccionado y agregar opciones al select de cars
        if (selectedTipo && datos_cars[selectedTipo]) {
            datos_cars[selectedTipo].forEach(vehiculo => {
                const option = document.createElement('option');
                option.textContent = vehiculo.nombre;
                option.setAttribute('data-descripcion', vehiculo.descripcion); // Guardar la descripci√≥n como atributo de datos
                option.setAttribute('data-tel', vehiculo.tel); // Guardar el n√∫mero de tel√©fono como atributo de datos
                selectCars.appendChild(option);
            });
        }

        // Cambiar la fuente de la imagen del veh√≠culo
		// Cambiar la fuente de la imagen del veh√≠culo
		const tipoVehiculo = selectedTipo.toLowerCase();
		const nombreArchivo = `${tipoVehiculo}.SVG`;
		console.log("Nombre del archivo:", nombreArchivo);
		imagenVehiculo.src = `detogo_app/${nombreArchivo}`;
		imagenVehiculo.alt = selectedTipo; // Cambiar el atributo alt de la imagen


    });

    // Agregar evento onChange al select de cars
    selectCars.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const descripcion = selectedOption.getAttribute('data-descripcion');
        const numeroTelefono = selectedOption.getAttribute('data-tel');

        // Mostrar la descripci√≥n del veh√≠culo
        divDescripcion.textContent = 'Descripci√≥n: ' + descripcion;

        // Crear botones para llamar por tel√©fono y WhatsApp
        const btnLlamar = document.createElement('button');
        btnLlamar.textContent = 'Llamar';
        btnLlamar.classList.add('btn-llamar-telefono');
        btnLlamar.onclick = function() {
            llamar_telefono(numeroTelefono);
        };

        const btnWhatsapp = document.createElement('button');
        btnWhatsapp.textContent = 'WhatsApp';
        btnWhatsapp.classList.add('btn-llamar-whatsapp');
        btnWhatsapp.onclick = function() {
            enviar_whatsapp(numeroTelefono);
        };

        // Limpiar el contenido actual de los botones y agregar los nuevos
        divBotonesCars.innerHTML = '';
        divBotonesCars.appendChild(btnLlamar);
        divBotonesCars.appendChild(btnWhatsapp);
    });

    // Agregar evento onChange al select de tipo de veh√≠culo (adicional)
    selectTipoCar.addEventListener('change', function() {
        // Simular el evento change en el select de cars para actualizar sus datos
        const event = new Event('change');
        selectCars.dispatchEvent(event);
    });
}
///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
function actualizar_pantalla_markets(datos_markets) {
    //obtenemos la ruta a la carpeta de trabajo 
    const departamentoSeleccionado = selectDepartamento.value;
    // Obtener la ubicaci√≥n seleccionada
    const ubicacionSeleccionada = selectUbicacion.value;
    // Concatenar el departamento y la ubicaci√≥n seleccionados
    let rutaCarpeta = departamentoSeleccionado + "," + ubicacionSeleccionada;
    // Aqu√≠ puedes realizar otras acciones con la ubicaci√≥n completa, como enviarla a la plataforma
    
    //encuentro la ruta a la carpeta que tiene el mismo nombre del archivo .txt
    rutaCarpeta = rutaCarpeta.replace(/\.[^/.]+$/, "");

    // Obtener el elemento donde se mostrar√°n los mercados
    const marketsDiv = document.getElementById('markets');
    // Limpiar el contenido actual del elemento
    marketsDiv.innerHTML = '';

    // Obtener el elemento donde se muestra mi tienda los mercados
    const mymarketsDiv = document.getElementById('my-market');
    // Limpiar el contenido actual del elemento
    mymarketsDiv.innerHTML = '';


 

    // Recorrer cada categor√≠a de mercado
    for (const categoria in datos_markets) {
        if (datos_markets.hasOwnProperty(categoria)) {
            // Crear un elemento de t√≠tulo para la categor√≠a
            const tituloCategoria = document.createElement('h2');
            tituloCategoria.textContent = categoria;

            // Agregar un evento de clic para mostrar u ocultar la lista de tiendas
            tituloCategoria.addEventListener('click', function() {
                // Mostrar u ocultar la lista de tiendas
                const listaTiendas = tituloCategoria.nextElementSibling;
                listaTiendas.style.display = listaTiendas.style.display === 'none' ? 'block' : 'none';
            });

            // Agregar el t√≠tulo de la categor√≠a al contenedor principal de mercados
            marketsDiv.appendChild(tituloCategoria);

            // Crear un contenedor para las listas de tiendas de la categor√≠a
            const listaTiendas = document.createElement('div');
            listaTiendas.classList.add('lista-tiendas');

            // Recorrer cada tienda de la categor√≠a y agregarla a la lista
            datos_markets[categoria].forEach(tienda => {
                
                // Crear un contenedor para la tienda
                const contenedorTienda = document.createElement('div');
                contenedorTienda.style.marginBottom = '35px';
                contenedorTienda.classList.add('tienda');
                

                // Contenedor para la imagen de la tienda
                const contenedorImagen = document.createElement('div');
                contenedorImagen.classList.add('imagen-tienda');
                contenedorImagen.style.display = 'inline-block';


                // Agregar los botones para llamar y WhatsApp
                const contenedorBotones = document.createElement('div');
                contenedorBotones.classList.add('botones-tienda');


                // Agregar la imagen de la tienda
                const imagenTienda = document.createElement('img');                         
									
				
				const ruta_a_tienda = rutaCarpeta+"/"+tienda.nombre;
				//console.log('rutaCarpeta # :', ruta_a_tienda);


               const extensiones = ["svg", "png", "jpg", "jpeg"];
                let encontrada = false;

                for (let ext of extensiones) {
                    const ruta = `${rutaCarpeta}/${tienda.nombre}/logo_tienda.${ext}`;
                    const img = new Image();
                    img.src = ruta;

                    img.onload = function() {
                        imagenTienda.src = ruta;
                        encontrada = true;
                    };

                    img.onerror = function() {
                        if (!encontrada) {
                            console.log(`No se encontr√≥: ${ruta}`);
                        }
                    };
                }
                
                //aqui debe crearse un boton para ir a la tienda
                imagenTienda.onload = function() {
				     // Verificar si el nombre de la imagen cargada es "logo_tienda"
				    if (imagenTienda.src.includes("logo_tienda")) {
				        // La imagen cargada es "logo_tienda", por lo tanto, creamos el bot√≥n

				        // Bot√≥n para ir a la tienda
				        const btnTienda = document.createElement('a');
                btnTienda.style.marginLeft = '15px';
				        //btnTienda.textContent = 'Tienda';                     
				        //btnTienda.classList.add('btn-tienda');

const imgBtnTienda = document.createElement('img');
// Establecer el atributo src con la ruta de la imagen
imgBtnTienda.src = 'detogo_app/mymarket.SVG'; // Reemplaza con la ruta correcta de la imagen
// Establecer cualquier otro atributo necesario para la imagen (como alt, width, etc.)
imgBtnTienda.alt = 'Nombre de la imagen'; // Texto alternativo para accesibilidad
imgBtnTienda.style.width = '30px'; // Ancho de la imagen en p√≠xeles (ajusta seg√∫n sea necesario)

// Agregar la imagen como hijo del bot√≥n
btnTienda.appendChild(imgBtnTienda);



                contenedorBotones.appendChild(btnTienda);

             


				        
				        // Agregar funcionalidad al bot√≥n
				        btnTienda.onclick = function() {

                   
                    // Obtener el enlace de la pesta√±a mymarket
                    const enlaceMymarket = document.querySelector('a[href="#mymarket"]');
                    // Verificar si se encontr√≥ el enlace
                    if (enlaceMymarket) {
                          // Simular un clic en el enlace de la pesta√±a mymarket
                          enlaceMymarket.click();
                          // L√≥gica para creasr el menu de la tienda
                          crear_tienda(ruta_a_tienda, tienda.tel);    



                    } else {
                          // Si el enlace no se encontr√≥, muestra un mensaje de error
                          console.error('No se encontr√≥ el enlace a la pesta√±a mymarket.');
                    }
                    


				                             
				        };
				        
				        // Agregar el bot√≥n al contenedor de botones
				        
				    }
				};

                
                // Manejar el evento onerror para cargar una imagen alternativa si la principal falla
				imagenTienda.onerror = function() {
   						// Cambiar la ruta de la imagen a la alternativa
    					imagenTienda.src = "detogo_app/gomarket.SVG";
				};              	    

                imagenTienda.style.width = '50px'; // Establece el ancho de la imagen
                imagenTienda.style.height = '50px'; // Establece la altura de la imagen
                imagenTienda.style.display = 'block';
				imagenTienda.style.margin = 'auto';

				// Dar espacio a la izquierda y a la derecha
				contenedorImagen.style.paddingLeft = '5px';
				contenedorImagen.style.paddingRight = '5px';
                 
                imagenTienda.alt = tienda.nombre;
                contenedorImagen.appendChild(imagenTienda);

                // Contenedor para el nombre, especialidad y botones
                const contenedorInfo = document.createElement('div');
                contenedorInfo.classList.add('info-tienda');
                contenedorInfo.style.display = 'inline-block';

                // Agregar el nombre de la tienda
                const nombreTienda = document.createElement('h4');
                nombreTienda.textContent = tienda.nombre;
                nombreTienda.style.marginBottom = '2px';
                nombreTienda.style.overflowWrap = 'break-word'; // Permite que el texto se rompa en palabras
                contenedorInfo.appendChild(nombreTienda);
               

                // Agregar la especialidad de la tienda
                const especialidadTienda = document.createElement('h5');
                especialidadTienda.textContent = tienda.especialidad;
                especialidadTienda.style.marginBottom = '2px';
                especialidadTienda.style.overflowWrap = 'break-word'; // Permite que el texto se rompa en palabras
                contenedorInfo.appendChild(especialidadTienda);


                // Agregar los botones para llamar y WhatsApp
                //const contenedorBotones = document.createElement('div');
                //contenedorBotones.classList.add('botones-tienda');
                 // Crear botones para llamar por tel√©fono y WhatsApp
     
 

                // Bot√≥n para llamar
                const btnLlamar = document.createElement('button');
                btnLlamar.textContent = 'Llamar';
                btnLlamar.classList.add('btn-llamar-telefono');

                btnLlamar.onclick = function() {
                    
                    llamar_telefono(tienda.tel);
                };
                contenedorBotones.appendChild(btnLlamar);

                // Bot√≥n para WhatsApp
                const btnWhatsapp = document.createElement('button');
                btnWhatsapp.textContent = 'WhatsApp';
                btnWhatsapp.classList.add('btn-llamar-whatsapp');
                btnWhatsapp.onclick = function() {
                   
                    enviar_whatsapp(tienda.tel);
                };
                contenedorBotones.appendChild(btnWhatsapp);


                // Agregar el contenedor de imagen al contenedor de tienda
                contenedorTienda.appendChild(contenedorImagen);
                
                // Agregar el contenedor de informaci√≥n al contenedor de tienda
                contenedorTienda.appendChild(contenedorInfo);

                // Agregar los botones al contenedor de informaci√≥n
                contenedorTienda.appendChild(contenedorBotones);

              

                // Agregar la tienda al contenedor de lista de tiendas
                listaTiendas.appendChild(contenedorTienda);
            });

            // Ocultar la lista de tiendas al principio
            listaTiendas.style.display = 'none';

            // Agregar la lista de tiendas al contenedor principal de mercados
            marketsDiv.appendChild(listaTiendas);
            
        }
    }
}

//#########################################################################
//#########################################################################
function actualizar_pantalla_comidas(datos_comida) {


    //obtenemos la ruta a la carpeta de trabajo 
    const departamentoSeleccionado = selectDepartamento.value;
    // Obtener la ubicaci√≥n seleccionada
    const ubicacionSeleccionada = selectUbicacion.value;
    // Concatenar el departamento y la ubicaci√≥n seleccionados
    let rutaCarpeta = departamentoSeleccionado + "," + ubicacionSeleccionada;
    // Aqu√≠ puedes realizar otras acciones con la ubicaci√≥n completa, como enviarla a la plataforma
    
    //encuentro la ruta a la carpeta que tiene el mismo nombre del archivo .txt
    rutaCarpeta = rutaCarpeta.replace(/\.[^/.]+$/, "");

    console.log('La p√°gina se ha cargado correctamente.',datos_comida); 

    // Obtener la referencia al div
    const soloComidasDiv = document.getElementById("solo-comidas");
    soloComidasDiv.innerHTML = '';


     // Crear un contenedor para las listas de tiendas de la categor√≠a
            const listaTiendas = document.createElement('div');
            listaTiendas.classList.add('lista-tiendas');

    // Iterar sobre las tiendas de comida y crear elementos para mostrar la informaci√≥n
    datos_comida.forEach(tienda => {

               // Crear un contenedor para la tienda
                const contenedorTienda = document.createElement('div');
                contenedorTienda.style.marginBottom = '35px';
                contenedorTienda.classList.add('tienda');
                

                // Contenedor para la imagen de la tienda
                const contenedorImagen = document.createElement('div');
                contenedorImagen.classList.add('imagen-tienda');
                contenedorImagen.style.display = 'inline-block';


                // Agregar los botones para llamar y WhatsApp
                const contenedorBotones = document.createElement('div');
                contenedorBotones.classList.add('botones-tienda');


                // Agregar la imagen de la tienda
                const imagenTienda = document.createElement('img');                         
                  
        
        const ruta_a_tienda = rutaCarpeta+"/"+tienda.nombre;
        //console.log('rutaCarpeta # :', ruta_a_tienda);


                imagenTienda.src = rutaCarpeta+"/"+tienda.nombre+"/"+"logo_tienda.SVG";
                
                //aqui debe crearse un boton para ir a la tienda
                imagenTienda.onload = function() {
             // Verificar si el nombre de la imagen cargada es "logo_tienda"
            if (imagenTienda.src.includes("logo_tienda")) {
                // La imagen cargada es "logo_tienda", por lo tanto, creamos el bot√≥n
                
                // Bot√≥n para ir a la tienda
                const btnTienda = document.createElement('a');
                btnTienda.style.marginLeft = '15px';
                //btnTienda.textContent = 'Tienda';    
                //btnTienda.classList.add('btn-tienda');

                // Crear un elemento <img> para la imagen
const imgBtnTienda = document.createElement('img');
// Establecer el atributo src con la ruta de la imagen
imgBtnTienda.src = 'detogo_app/mymarket.SVG'; // Reemplaza con la ruta correcta de la imagen
// Establecer cualquier otro atributo necesario para la imagen (como alt, width, etc.)
imgBtnTienda.alt = 'Nombre de la imagen'; // Texto alternativo para accesibilidad
imgBtnTienda.style.width = '30px'; // Ancho de la imagen en p√≠xeles (ajusta seg√∫n sea necesario)

// Agregar la imagen como hijo del bot√≥n
btnTienda.appendChild(imgBtnTienda);
              






                // Agregar el bot√≥n al contenedor de botones
                contenedorBotones.appendChild(btnTienda);
                
                // Agregar funcionalidad al bot√≥n
                btnTienda.onclick = function() {
                     
                    // Obtener el enlace de la pesta√±a mymarket
                    const enlaceMymarket = document.querySelector('a[href="#mymarket"]'); 
                    
                    // Verificar si se encontr√≥ el enlace
                    if (enlaceMymarket) {
                          // Simular un clic en el enlace de la pesta√±a mymarket
                          enlaceMymarket.click();
                           // L√≥gica para redirigir al usuario a la tienda                    
                          crear_tienda(ruta_a_tienda, tienda.tel);                           


                    } else {
                          // Si el enlace no se encontr√≥, muestra un mensaje de error
                          console.error('No se encontr√≥ el enlace a la pesta√±a mymarket.');
                    }
                       
                };
                
                
            }
        };

                
                // Manejar el evento onerror para cargar una imagen alternativa si la principal falla
        imagenTienda.onerror = function() {
              // Cambiar la ruta de la imagen a la alternativa
              imagenTienda.src = "detogo_app/gomarket.SVG";
        };                    

                imagenTienda.style.width = '50px'; // Establece el ancho de la imagen
                imagenTienda.style.height = '50px'; // Establece la altura de la imagen
                imagenTienda.style.display = 'block';
        imagenTienda.style.margin = 'auto';

        // Dar espacio a la izquierda y a la derecha
        contenedorImagen.style.paddingLeft = '5px';
        contenedorImagen.style.paddingRight = '5px';
                 
                imagenTienda.alt = tienda.nombre;
                contenedorImagen.appendChild(imagenTienda);

                // Contenedor para el nombre, especialidad y botones
                const contenedorInfo = document.createElement('div');
                contenedorInfo.classList.add('info-tienda');
                contenedorInfo.style.display = 'inline-block';

                // Agregar el nombre de la tienda
                const nombreTienda = document.createElement('h4');
                nombreTienda.textContent = tienda.nombre;
                nombreTienda.style.marginBottom = '2px';
                nombreTienda.style.overflowWrap = 'break-word'; // Permite que el texto se rompa en palabras
                contenedorInfo.appendChild(nombreTienda);
               

                // Agregar la especialidad de la tienda
                const especialidadTienda = document.createElement('h5');
                especialidadTienda.textContent = tienda.especialidad;
                especialidadTienda.style.marginBottom = '2px';
                especialidadTienda.style.overflowWrap = 'break-word'; // Permite que el texto se rompa en palabras
                contenedorInfo.appendChild(especialidadTienda);


                // Agregar los botones para llamar y WhatsApp
                //const contenedorBotones = document.createElement('div');
                //contenedorBotones.classList.add('botones-tienda');
                

                // Bot√≥n para llamar
                const btnLlamar = document.createElement('button');
                btnLlamar.textContent = 'Llamar';
                btnLlamar.classList.add('btn-llamar-telefono');

                btnLlamar.onclick = function() {
                    
                    llamar_telefono(tienda.tel);
                };
                contenedorBotones.appendChild(btnLlamar);

                // Bot√≥n para WhatsApp
                const btnWhatsapp = document.createElement('button');
                btnWhatsapp.textContent = 'WhatsApp';
                btnWhatsapp.classList.add('btn-llamar-whatsapp');
                btnWhatsapp.onclick = function() {
                   
                    enviar_whatsapp(tienda.tel);
                };
                contenedorBotones.appendChild(btnWhatsapp);



         

                // Agregar el contenedor de imagen al contenedor de tienda
                contenedorTienda.appendChild(contenedorImagen);
                 // Agregar el contenedor de informaci√≥n al contenedor de tienda
                contenedorTienda.appendChild(contenedorInfo);

                // Agregar los botones al contenedor de informaci√≥n
                contenedorTienda.appendChild(contenedorBotones);

                
                
               





                // Agregar la tienda al contenedor de lista de tiendas
                listaTiendas.appendChild(contenedorTienda);
            });

                    
                soloComidasDiv.appendChild(listaTiendas); 
   
    
}



///////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////


 function actualizar_pantalla_servicios(datos_servicios) {
    // Obtener el elemento donde se mostrar√°n los servicios
    const serviciosDiv = document.getElementById('service');
    // Limpiar el contenido actual del elemento
    serviciosDiv.innerHTML = '';

    // Recorrer cada categor√≠a de servicios
    for (const categoria in datos_servicios) {
        if (datos_servicios.hasOwnProperty(categoria)) {
            // Crear un elemento de t√≠tulo para la categor√≠a
            const tituloCategoria = document.createElement('h2');
            tituloCategoria.textContent = categoria;

            // Agregar un evento de clic para mostrar u ocultar la lista de servicios
            tituloCategoria.addEventListener('click', function() {
                // Mostrar u ocultar la lista de servicios
                const listaServicios = tituloCategoria.nextElementSibling;
                listaServicios.style.display = listaServicios.style.display === 'none' ? 'block' : 'none';
            });

            // Agregar el t√≠tulo de la categor√≠a al contenedor principal de servicios
            serviciosDiv.appendChild(tituloCategoria);

            // Crear un contenedor para las listas de servicios de la categor√≠a
            const listaServicios = document.createElement('div');
            listaServicios.classList.add('lista-servicios');

            // Recorrer cada servicio de la categor√≠a y agregarlo a la lista
            datos_servicios[categoria].forEach(servicio => {
                // Crear un div para cada servicio
                const servicioDiv = document.createElement('div');
                servicioDiv.classList.add('servicio');

                // Crear un div para la imagen
                const imagenDiv = document.createElement('div');
                imagenDiv.classList.add('imagen');
                // Dar espacio a la izquierda y a la derecha
                imagenDiv.style.paddingLeft = '5px';
                imagenDiv.style.paddingRight = '5px';
                imagenDiv.style.display = 'flex'; // Establece el contenedor como flexible
                imagenDiv.style.alignItems = 'center'; // Centra verticalmente los elementos dentro del contenedor

                // Crear la imagen
                const imagenPersona = document.createElement('img');
                imagenPersona.src = "detogo_app/people.SVG";
                imagenPersona.style.width = '50px'; // Establece el ancho de la imagen
                imagenPersona.style.height = '50px'; // Establece la altura de la imagen
                imagenPersona.alt = "people";


                // Agregar la imagen al div de imagen
                imagenDiv.appendChild(imagenPersona);

                // Crear elementos para mostrar la informaci√≥n del servicio
                const nombreServicio = document.createElement('h4');
                nombreServicio.textContent = servicio.nombre;

                const especialidadServicio = document.createElement('h5');
                especialidadServicio.textContent = 'Especialidad: ' + servicio.especialidad;

                // Crear el contenedor de botones
                const contenedorBotones = document.createElement('div');
                contenedorBotones.classList.add('botones');

              
                // Bot√≥n para llamar
                const btnLlamar = document.createElement('button');
                btnLlamar.textContent = 'Llamar';
                btnLlamar.classList.add('btn-llamar-telefono');

                btnLlamar.onclick = function() {
                    
                    llamar_telefono(servicio.telefono);
                };
                contenedorBotones.appendChild(btnLlamar);

                // Bot√≥n para WhatsApp
                const btnWhatsapp = document.createElement('button');
                btnWhatsapp.textContent = 'WhatsApp';
                btnWhatsapp.classList.add('btn-llamar-whatsapp');
                btnWhatsapp.onclick = function() {
                   
                    enviar_whatsapp(servicio.telefono);
                };
                contenedorBotones.appendChild(btnWhatsapp);

                // Agregar elementos al div del servicio
                servicioDiv.appendChild(nombreServicio);
                servicioDiv.appendChild(especialidadServicio);
                servicioDiv.appendChild(contenedorBotones);

                // Agregar el contenedor de imagen y el contenedor de servicio al contenedor principal
                const fichaPersonalDiv = document.createElement('div');
                fichaPersonalDiv.classList.add('ficha-personal');
                fichaPersonalDiv.style.display = 'flex'; // Alinea los elementos horizontalmente
                fichaPersonalDiv.style.marginBottom = '25px';
                                
                fichaPersonalDiv.appendChild(imagenDiv);
                fichaPersonalDiv.appendChild(servicioDiv);

                // Agregar la ficha personal al div de servicios
                listaServicios.appendChild(fichaPersonalDiv);
            });

            // Ocultar la lista de servicios al principio
            listaServicios.style.display = 'none';

            // Agregar la lista de servicios al contenedor principal de servicios
            serviciosDiv.appendChild(listaServicios);
        }
    }
}

//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
async function listar_promocionales() {

    // Mostrar los nombres de los archivos PNG en la lista
        const listaPromocionalesElement = document.getElementById("lista-promocionales");          
        listaPromocionalesElement.innerHTML = '';

    //obtenemos la ruta a la carpeta de trabajo 
    const departamentoSeleccionado = selectDepartamento.value;
    // Obtener la ubicaci√≥n seleccionada
    let ubicacionSeleccionada = selectUbicacion.value;

    //encuentro la ruta a la carpeta que tiene el mismo nombre del archivo .txt
    ubicacionSeleccionada = ubicacionSeleccionada.replace(/\.[^/.]+$/, "");

    // Concatenar el departamento y la ubicaci√≥n seleccionados
    let rutaCarpetaPromocional = departamentoSeleccionado + "," + ubicacionSeleccionada+"/"+"Promocionales";
    // Aqu√≠ puedes realizar otras acciones con la ubicaci√≥n completa, como enviarla a la plataforma

    console.log('Ruta :', rutaCarpetaPromocional);
    
    
    try {
        // Realizar una solicitud al servidor para obtener la lista de archivos PNG en la carpeta de la tienda
        const username = 'detogo';
        const repo = 'detogo.github.io';

        // console.log('rutaCarpeta # :', ruta_a_tienda);

        const ruta_completa_imagenes = `https://api.github.com/repos/${username}/${repo}/contents/${rutaCarpetaPromocional}`;
        
        const response = await fetch( ruta_completa_imagenes );      
        const data = await response.json();
        
        console.log('data :', data);

        // Obtener los nombres de los archivos PNG en la carpeta de la tienda
        const archivos_png = data.filter(file => file.name.toLowerCase().endsWith(".png"));
        
        

        archivos_png.forEach(archivo => {  

            console.log('archivo.name :', archivo.name);     
          
            const ruta_a_la_imagen = rutaCarpetaPromocional + "/" + archivo.name;  
            console.log('ruta_a_la_imagen :', ruta_a_la_imagen);     

            const partesNombre = archivo.name.split(",");
            
            const nombrePromocional = partesNombre[0]; // Quita la extensi√≥n
            const lugarPromocional = partesNombre[1]; // Quita la extensi√≥n
            const fechaPromocional = partesNombre[2]; // Quita la extensi√≥n
            const telefonoPromocional = partesNombre[3].replace(/\.[^/.]+$/, "");//Quita la extensi√≥n      
                  
           console.log('telefonoPromocional :', telefonoPromocional); 

          const contenedor_promocional = document.createElement("div");
contenedor_promocional.style.borderRadius = "20px";
contenedor_promocional.style.borderWidth = "1px";
contenedor_promocional.style.borderColor = "gray";
contenedor_promocional.style.borderStyle = "solid";
contenedor_promocional.style.paddingBottom = "10px";
contenedor_promocional.style.width = "100%"; // Ocupa todo el ancho posible
contenedor_promocional.style.marginBottom = "20px"; // Espacio de 20px en la parte inferior



            const listPromocionales = document.createElement("div");
            listPromocionales.style.borderRadius = "10px"; // Establece el radio de borde para hacerlo redondeado
            listPromocionales.style.marginBottom = "40px"; // Agrega un espacio inferior de 20px              

          
            // Crear el logo de la tienda
            const logoDetogo = document.createElement('img');
            logoDetogo.src = "detogo_app/detogo_logo.svg"; // Ajusta la ruta seg√∫n sea necesario
            
            logoDetogo.style.top = "10px"; // Posiciona el logo en la esquina superior izquierda
            logoDetogo.style.left = "10px";
            logoDetogo.style.width = "65px"; // Tama√±o del logo, ajusta seg√∫n sea necesario
            logoDetogo.style.height = "65px";
            logoDetogo.style.borderRadius = "50%"; // Para hacerlo redondo
            logoDetogo.alt = 'Logo de tienda';  
            logoDetogo.style.display = 'inline-block';           


            const nombrePromocionalElemento = document.createElement("h3");
            nombrePromocionalElemento.textContent = nombrePromocional;   
            nombrePromocionalElemento.style.display = 'inline-block';  
            nombrePromocionalElemento.style.paddingLeft = "10px";      



            const datosDescriptivoelemento = document.createElement("div");
            datosDescriptivoelemento.style.paddingLeft = "20px";
                    
              const lugarPromocionalElemento = document.createElement("h4");
              lugarPromocionalElemento.textContent = lugarPromocional;           

              const fechaPromocionalElemento = document.createElement("h5");
              fechaPromocionalElemento.textContent = fechaPromocional;  
                          
            datosDescriptivoelemento.appendChild(lugarPromocionalElemento);
            datosDescriptivoelemento.appendChild(fechaPromocionalElemento);
            



            // Agregar el nombre del producto al elemento de la lista
            // Agregar el logo de la tienda al contenedor
            listPromocionales.appendChild(logoDetogo);
            listPromocionales.appendChild(nombrePromocionalElemento);
            listPromocionales.appendChild(datosDescriptivoelemento);        




            // Crear un contenedor para la imagen 
            const contenedorImagen = document.createElement('div');
            contenedorImagen.style.position = "relative";
            contenedorImagen.style.overflow = "hidden";
            contenedorImagen.style.borderRadius = "10px"; // Borde redondeado
            contenedorImagen.style.paddingBottom = "10px";
            contenedorImagen.style.display = "flex"; // Usar flexbox para centrar elementos
            

            // Crear la imagen
            const imagen = document.createElement('img');
            imagen.src = ruta_a_la_imagen;
            imagen.style.width = "100%";
            imagen.alt = 'Imagen de tienda';

            // Agregar la imagen al contenedor
            contenedorImagen.appendChild(imagen);   

        

// Agregar los botones para llamar y WhatsApp
                const contenedorBotones = document.createElement('div');                
                contenedorBotones.style.paddingBottom = "5px";
                contenedorBotones.style.paddingLeft = "30px";
             
 
                 // Bot√≥n para llamar
                const btnLlamar = document.createElement('button');
                btnLlamar.textContent = 'Llamar';
                btnLlamar.classList.add('btn-llamar-telefono');

                btnLlamar.onclick = function() {
                    
                    llamar_telefono(telefonoPromocional);
                };
                contenedorBotones.appendChild(btnLlamar);

                // Bot√≥n para WhatsApp
                const btnWhatsapp = document.createElement('button');
                btnWhatsapp.textContent = 'WhatsApp';
                btnWhatsapp.classList.add('btn-llamar-whatsapp');
                btnWhatsapp.onclick = function() {
                   
                    enviar_whatsapp(telefonoPromocional);
                };
                contenedorBotones.appendChild(btnWhatsapp);




                // Agregar los botones al contenedor de informaci√≥n
               



            // Agregar el contenedor de imagen y logo a la lista
            contenedor_promocional.appendChild(listPromocionales);
            contenedor_promocional.appendChild(contenedorImagen);
            contenedor_promocional.appendChild(contenedorBotones);

            listaPromocionalesElement.appendChild(contenedor_promocional);









        });


    } catch (error) {
        console.error('Error al obtener el listado de archivos promocionales PNG:', error);
    }
}






//#########################################################################
//#########################################################################
function crear_tienda(ruta_a_tienda,tienda_telefono) {
    // Obtener el div donde se mostrar√°n las im√°genes de la tienda
    const marketDiv = document.getElementById('my-market');
    // Limpiar el contenido actual del div
    marketDiv.innerHTML = '';
    // Hacer una solicitud para obtener la lista de archivos en la carpeta de la tienda
    // Esto depende de c√≥mo est√© implementado tu backend o servidor
    // Supongamos que obtienes una lista de nombres de archivo en formato JSON
    const listaArchivos = listar_archivos_png(ruta_a_tienda,tienda_telefono); // Funci√≥n ficticia, reempl√°zala con tu l√≥gica real

    // Recorrer la lista de archivos y crear elementos de imagen para cada uno
    

}

async function listar_archivos_png(ruta_a_tienda,tienda_telefono) {

    console.log('datos tienda 1 # :', ruta_a_tienda);
    console.log('datos tienda 2 # :', tienda_telefono);
    // Dividir la ruta en sus partes usando el car√°cter de separaci√≥n correcto
    const partesRuta = ruta_a_tienda.split("/");
    // Tomar la √∫ltima parte que corresponde al nombre de la tienda
    const nombreTienda = partesRuta[partesRuta.length - 1];
    console.log('datos tienda 3 # :', nombreTienda);
    
    try {
        // Realizar una solicitud al servidor para obtener la lista de archivos PNG en la carpeta de la tienda
        const username = 'detogo';
        const repo = 'detogo.github.io';

        // console.log('rutaCarpeta # :', ruta_a_tienda);

        const ruta_completa_imagenes = `https://api.github.com/repos/${username}/${repo}/contents/${ruta_a_tienda}`;
        
        const response = await fetch( ruta_completa_imagenes );      
        const data = await response.json();
        
        // Obtener los nombres de los archivos PNG en la carpeta de la tienda
        const archivos_png = data.filter(file => file.name.toLowerCase().endsWith(".png"));
        
        // Mostrar los nombres de los archivos PNG en la lista
        const listaArchivos = document.getElementById("my-market");             
       




        archivos_png.forEach(archivo => {       
          
            const ruta_a_la_imagen = ruta_a_tienda + "/" + archivo.name;    

            const partesNombre = archivo.name.split(",");
            const nombreProducto = partesNombre[0]; // Quita la extensi√≥n
            const descripcionProducto = partesNombre[1]; // Quita la extensi√≥n
            const precioProducto = partesNombre[2].replace(/\.[^/.]+$/, "");//Quita la extensi√≥n      
            

const contenedor_publicacion = document.createElement("div");
contenedor_publicacion.style.borderRadius = "20px";
contenedor_publicacion.style.borderWidth = "1px";
contenedor_publicacion.style.borderColor = "gray";
contenedor_publicacion.style.borderStyle = "solid";
contenedor_publicacion.style.paddingBottom = "10px";
contenedor_publicacion.style.width = "100%"; // Ocupa todo el ancho posible
contenedor_publicacion.style.marginBottom = "20px"; // Espacio de 20px en la parte inferior



            const listItem = document.createElement("div");
            listItem.style.borderRadius = "10px"; // Establece el radio de borde para hacerlo redondeado
            listItem.style.marginBottom = "40px"; // Agrega un espacio inferior de 20px              

          
            // Crear el logo de la tienda
            const logoTienda = document.createElement('img');
            logoTienda.src = ruta_a_tienda + "/logo_tienda.SVG"; // Ajusta la ruta seg√∫n sea necesario
            
            logoTienda.style.top = "10px"; // Posiciona el logo en la esquina superior izquierda
            logoTienda.style.left = "10px";
            logoTienda.style.width = "65px"; // Tama√±o del logo, ajusta seg√∫n sea necesario
            logoTienda.style.height = "65px";
            logoTienda.style.borderRadius = "50%"; // Para hacerlo redondo
            logoTienda.alt = 'Logo de tienda';  
            logoTienda.style.display = 'inline-block';           


            const nombreTiendaElemento = document.createElement("h3");
            nombreTiendaElemento.textContent = nombreTienda;   
            nombreTiendaElemento.style.display = 'inline-block';  
            nombreTiendaElemento.style.paddingLeft = "10px";      



            const nombreDescriptivoelement = document.createElement("div");
            nombreDescriptivoelement.style.paddingLeft = "20px";
                    
              const nombreProductoElemento = document.createElement("h4");
              nombreProductoElemento.textContent = nombreProducto;           

              const descripcionProductoElemento = document.createElement("h5");
              descripcionProductoElemento.textContent = descripcionProducto;  
                          
            nombreDescriptivoelement.appendChild(nombreProductoElemento);
            nombreDescriptivoelement.appendChild(descripcionProductoElemento);
            



            // Agregar el nombre del producto al elemento de la lista
            // Agregar el logo de la tienda al contenedor
            listItem.appendChild(logoTienda);
            listItem.appendChild(nombreTiendaElemento);
            listItem.appendChild(nombreDescriptivoelement);        


            // Crear un contenedor para la imagen 
            const contenedorImagen = document.createElement('div');
            contenedorImagen.style.position = "relative";
            contenedorImagen.style.overflow = "hidden";
            contenedorImagen.style.borderRadius = "10px"; // Borde redondeado
            contenedorImagen.style.paddingBottom = "10px";
            contenedorImagen.style.display = "flex"; // Usar flexbox para centrar elementos
            

            // Crear la imagen
            const imagen = document.createElement('img');
            imagen.src = ruta_a_la_imagen;
            imagen.style.width = "100%";
            imagen.alt = 'Imagen de tienda';

            // Agregar la imagen al contenedor
            contenedorImagen.appendChild(imagen);   


            // Crear el c√≠rculo blanco
const circuloBlanco = document.createElement('div');
circuloBlanco.style.position = "absolute";
circuloBlanco.style.top = "10pt";
circuloBlanco.style.right = "10pt";
circuloBlanco.style.backgroundColor = "black";
circuloBlanco.style.borderRadius = "50%";
circuloBlanco.style.width = "70px";
circuloBlanco.style.height = "70px";
circuloBlanco.style.display = "flex";
circuloBlanco.style.justifyContent = "margin-top";
circuloBlanco.style.alignItems = "center";

// Crear el elemento span para mostrar el precioProducto
const precioProductoElemento = document.createElement('span');
precioProductoElemento.textContent = precioProducto;

precioProductoElemento.style.textAlign = "center";
precioProductoElemento.style.color = "white";
// Establecer el tama√±o de la fuente del texto
precioProductoElemento.style.fontSize = "20px";
// Establecer la altura del contenedor del texto para centrarlo verticalmente
precioProductoElemento.style.lineHeight = "50px"; // Ajusta el valor seg√∫n sea necesario
precioProductoElemento.style.linewidth = "50px"; // Ajusta el valor seg√∫n sea necesario

// Agregar el precioProducto al c√≠rculo blanco
circuloBlanco.appendChild(precioProductoElemento);

// Agregar el c√≠rculo blanco al contenedor de la imagen
contenedorImagen.appendChild(circuloBlanco);    




// Agregar los botones para llamar y WhatsApp
                const contenedorBotones = document.createElement('div');                
                contenedorBotones.style.paddingBottom = "5px";
                contenedorBotones.style.paddingLeft = "30px";
          



                 // Bot√≥n para llamar
                const btnLlamar = document.createElement('button');
                btnLlamar.textContent = 'Llamar';
                btnLlamar.classList.add('btn-llamar-telefono');

                btnLlamar.onclick = function() {
                    
                    llamar_telefono(tienda_telefono);
                };
                contenedorBotones.appendChild(btnLlamar);

                // Bot√≥n para WhatsApp
                const btnWhatsapp = document.createElement('button');
                btnWhatsapp.textContent = 'WhatsApp';
                btnWhatsapp.classList.add('btn-llamar-whatsapp');
                btnWhatsapp.onclick = function() {
                   
                    enviar_whatsapp(tienda_telefono);
                };
                contenedorBotones.appendChild(btnWhatsapp);

                // Agregar los botones al contenedor de informaci√≥n
               

            // Agregar el contenedor de imagen y logo a la lista
            contenedor_publicacion.appendChild(listItem);
            contenedor_publicacion.appendChild(contenedorImagen);
            contenedor_publicacion.appendChild(contenedorBotones);

            listaArchivos.appendChild(contenedor_publicacion);           
           
        });


    } catch (error) {
        console.error('Error al obtener el listado de archivos PNG:', error);
    }
}


   


function enviar_whatsapp(numero_telefono) {
    if (isAppInventor) {

            console.log("Solicitando whatsapp...");
            AppInventor.setWebViewString("WhatsApp,"+numero_telefono);

        
        } else {

             window.location.href = "https://wa.me/" + numero_telefono;
            
        }
    
}


 function llamar_telefono(numero_telefono) {
        
        if (isAppInventor) {

            console.log("Solicitando llamar...");
            AppInventor.setWebViewString("Llamar,"+numero_telefono);
        
        } else {

             window.location.href = "tel:" + numero_telefono;
            
        }
    
    }



function cambiar_apidetogo(bandera) {
        
    if (isAppInventor) {
          
          if (bandera===0){
            console.log("hacer cambio...");
            AppInventor.setWebViewString("api.detogo");
          }else{
            console.log("hacer cambio...");
            AppInventor.setWebViewString("detogo");
          }           
    }    
}







</script>  



<script> 

const slider = document.querySelector('.gallery_toolbar');
let isDown = false;
let startX;
let scrollLeft;

slider.addEventListener('mousedown', e => {
  isDown = true;
  slider.classList.add('active');
  startX = e.pageX - slider.offsetLeft;
  scrollLeft = slider.scrollLeft;
});
slider.addEventListener('mouseleave', _ => {
  isDown = false;
  slider.classList.remove('active');
});
slider.addEventListener('mouseup', _ => {
  isDown = false;
  slider.classList.remove('active');
});
slider.addEventListener('mousemove', e => {
  if (!isDown) return;
  e.preventDefault();
  const x = e.pageX - slider.offsetLeft;
  const SCROLL_SPEED = 3;
  const walk = (x - startX) * SCROLL_SPEED;
  slider.scrollLeft = scrollLeft - walk;
});
</script> 








<script>
let touchStartX = 0;
let touchEndX = 0;
const minSwipeDistance = 50; // Umbral m√≠nimo de desplazamiento en p√≠xeles
let recentSwipe = false;

const tabContent = document.querySelector('.tab-content');

tabContent.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
    recentSwipe = true; // Reiniciar la bandera de desplazamiento reciente
});

tabContent.addEventListener('touchmove', (e) => {

    touchEndX = e.touches[0].clientX;
    recentSwipe = false; // Establecer la bandera de desplazamiento reciente
});


tabContent.addEventListener('touchend', () => {
    const difference = touchStartX - touchEndX;
    if (Math.abs(difference) > minSwipeDistance) { // Umbral de desplazamiento
        console.log('difference', difference);


        if (difference > 0) {
            // Desplazarse a la izquierda
            console.log('Desplazamiento hacia la izquierdaa');
            simularClickSiguiente();
        } else {
            // Desplazarse a la derecha
            console.log('Desplazamiento hacia la derechaa');
            simularClickAnterior();
        }
    }

    touchStartX = 0;
    touchEndX = 0;
});

function simularClickSiguiente() {
    if (!recentSwipe) {
        const currentTab = document.querySelector('.tab-pane.active');
        const nextTab = currentTab.nextElementSibling;
        if (nextTab) {
            const nextTabLink = document.querySelector(`[href="#${nextTab.id}"]`);
            if (nextTabLink) {
                console.log('Simulando clic en la pesta√±a siguiente:', nextTab.id);
                nextTabLink.click();
            }
        }
    }
}

function simularClickAnterior() {
    if (!recentSwipe) {
        const currentTab = document.querySelector('.tab-pane.active');
        const prevTab = currentTab.previousElementSibling;
        if (prevTab) {
            const prevTabLink = document.querySelector(`[href="#${prevTab.id}"]`);
            if (prevTabLink) {
                console.log('Simulando clic en la pesta√±a anterior:', prevTab.id);
                prevTabLink.click();
            }
        }
    }
}


   
</script>



<script>
    document.addEventListener("DOMContentLoaded", function () {
        let menu = document.getElementById("menu");
        let menuBtn = document.getElementById("menuBtn");

        let touchStartX = 0;
        let touchEndX = 0;
        let mouseStartX = 0;
        let mouseEndX = 0;

        // Funci√≥n para abrir/cerrar men√∫
        function toggleMenu(open) {
            if (open) {
                menu.classList.add("show");
            } else {
                menu.classList.remove("show");
            }
        }

        // Evento para bot√≥n de men√∫ en PC
        menuBtn.addEventListener("click", function () {
            menu.classList.toggle("show");
        });

        // Eventos t√°ctiles para m√≥viles
        document.body.addEventListener("touchstart", function (event) {
            touchStartX = event.touches[0].clientX;
        });

        document.body.addEventListener("touchmove", function (event) {
            touchEndX = event.touches[0].clientX;
        });

        document.body.addEventListener("touchend", function () {
            if (touchStartX < 50 && touchEndX > touchStartX + 50) {
                toggleMenu(true);
            } else if (touchStartX > 150 && touchEndX < touchStartX - 50) {
                toggleMenu(false);
            }
        });

        // Eventos de mouse para PC (arrastre)
        document.body.addEventListener("mousedown", function (event) {
            mouseStartX = event.clientX;
        });

        document.body.addEventListener("mouseup", function (event) {
            mouseEndX = event.clientX;

            //if (mouseStartX < 50 && mouseEndX > mouseStartX + 50) {
            //    toggleMenu(true);
            //} else if (mouseStartX > 150 && mouseEndX < mouseStartX - 50) {
             //   toggleMenu(false);
            //}
        });
    });
</script>





<script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
<script src="bootstrap/js/jquery.min.js" ></script>
<script src="bootstrap/js/bootstrap.min.js"></script>

</body>
</html>